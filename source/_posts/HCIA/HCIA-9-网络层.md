---
title: HCIA -- 9 -- 网络层
date: 2023-09-01 22:14:46
tags:
  - HCIA
  - 网络层
---
## 一、网络层的主要功能

1. 提供了通讯工程中必须要使用的另一个地址：逻辑 IP 地址【IPv4、IPv6】
2. 连接不同的媒介类型【内网 — 外网(Intra — Inter)】
3. 根据运行的不同路由协议，选择不同的最佳路径
4. 在选择好的最佳路径上负责路由数据包

### IP包头格式

<table style="text-align:center;width:700px">

<tr style="background:rgb(238,133,109)">
	<td>版本 (4)</td><td>首部长度 (4)</td><td>优先级与服务类型 (8)</td><td colspan="2">总长度 (16)</td><td rowspan="5" style="background:#fff">20 字节</td>
</tr>
<tr style="background:rgb(238,234,217)">
	<td colspan="3">标识符 (16)</td><td>标志 (3)</td><td>段偏移量 (13)</td>
</tr>
<tr style="background:rgb(238,133,109,0.6)">
	<td colspan="2">TTL (8)</td><td>协议号 (8)</td><td colspan="2">首部校验和 (16)</td>
</tr>
<tr style="background:rgb(238,234,217)">
	<td colspan="5">源IP地址 (16)</td>
</tr>
<tr style="background:rgb(238,133,109,0.6)">
	<td colspan="5">目标IP地址 (16)</td>
</tr>
<tr style="background:rgb(238,234,217)">
	<td colspan="5">可选项</td><td rowspan="2" style="background:#fff"></td>
</tr>
<tr style="background:rgb(238,133,109,0.6)">
	<td colspan="5">数据</td>
</tr>
</table>

## QoS【服务质量】

`分类、标记、流量调节、拥塞管理、拥塞避免`

7. 网络协议保留使用
6. 网络协议保留使用
5. 音频流量
4. 振铃流量
3. 视频流量
2. 高优先级
1. 中优先级
0. BE【尽力而为】

## 二、网络层的IPv4头部

网络层的 `IP` 头部默认为 `20Byte`

1. 版本字段：用来表明当前IP协议所使用的版本号【IPv4】。
2. 首部长度字段：用来表明当前IP头部一共多大【默认20Byte】。
3. 服务类型与优先级：用来配合三层实现QoS使用。
4. 总长度：包含各层头部封装与用户发送的原始数据的总大小。
5. 标识符：
6. 标志：在数据被分片之后，传送到对端，对端重组时保证不会乱序。
7. 段偏移量：
8. TTL：网络中的每一个数据包默认都携带一TTL值，该值经过一个3层设备就减 1，当减至0时还没有被任何接收方接收，则该数据自动消失被丢弃，保证网络中不存在过多的垃圾文件。
9. 协议号：三层与四层之间的服务接入点，若协议号为6，则表明上层使用的是TCP，若协议号为17，则表明上层使用的是UDP。
10. 首部校验和：三层用来在首部进行校验和检测的地方。
11. 源 IP 地址：32 bit
12. 目的 IP 地址：32 bit

## 三、IP地址的作用

1. 一个IP地址可以用来标识一个独立的网络节点。
2. 可以用来标识一个网段【组】。

## 四、IP地址的分类

- A：1 — 126 【通讯使用】
- B：128 — 191 【通讯使用】
- C：192 — 223 【通讯使用】
- D：224 — 239 【组播使用】
- E：240 — 254 【科学研究使用】

`注：127【本地回环接口地址】：用来实现本机网卡测试。`
`::1：IPv6 中的本地回环接口地址。`

## 五、私有地址

- A：10.0.0.0/8
- B：172.16.0.0 — 172.31.255.255/12
- C：192.168.0.0 — 192.168.255.255/16

私有地址是网络从 `IPv4` 向 `IPv6` 过度种的过度技术，通过使用私有地址，能够明显的降低公有地址的消耗过度。
除了以上 3 段私有地址外，其他地址均为公有地址
注：`169.254.0.0/16 是微软买断的一个网段`

## 六、子网掩码的作用

用来区分不同的网段

## 七、子网的划分

1. 主机位不能全为 0，主机位全为 0 则表示的是网段
2. 主机位不能全为 1，主机为全为 1 则表示的是广播地址

## 八、ARP 协议

地址解析协议：已知对方的 `IP地址`，解析对方的 `MAC地址`。
客户端在与对端设备通讯时，首先检测自身的 `ARP缓存表`，若自身的 `ARP缓存表` 中不存在对端的 `IP` 与 `MAC地址` 的映射关系，则信源发送 `ARP广播请求`。
在信源发送的 `ARP广播请求` 中，包含了其自身的 `源IP地址` 与 `源MAC地址`，当对端设备接收到该 `ARP广播请求` 后，对端设备将会给予单播响应回复，而无需发送广播响应。
在信源得知了对端的 `MAC地址` 后，将对端设备 `IP地址` 与 `MAC地址` 做对应关系，保存在自身的 `ARP缓存表` 中后，方可与对端通讯。

## 九、RARP 反向地址解析协议

已知自身的 MAC地址，广播请求一个 IP地址
网络中的负责分配 IP地址 的服务器单薄给予响应，为客户端分配 IP地址

`注：RARP就是DHCP的前身协议`
RARP 因为需要让负责分配 `IP地址` 的服务器预先知道客户端的 `MAC地址` 后，才能给客户端分配 `IP地址`。

## 十、代理 ARP

1. 路由器默认情况下不会发送广播报文。
2. 来自客户端的 `ARP广播请求` 不会被路由器传至对端。
3. 路由器会将自身接口的 `IP地址` 与 `MAC地址` 以单播的方式响应给信源主机，信源主机的 `ARP缓存表` 中保存的就是直连路由器的接口 `IP地址` 与 `MAC地址` 的对应关系。
4. 信源主机就会将所有访问目标网络的数据统一发送给自己的直连路由器。
5. 路由器在两个客户端通讯的过程中，起到代理的作用。

## 十一、ICMP 【网际控制消息协议】

- ICMP：用来检测网络的双向连通性。
- ping [-t] [-a] [-l 字节数] IP_Address ｜ Target_names